version: "3"
services:
  erigon:
    image: jfinchain/erigon:devel
    user: root
    entrypoint: /root/init-script.sh
    command:
      - "--datadir=/datadir/erigon"
      - "--bootnodes=enode://db210a13910d6344b284c16647231e82173643271618a2c2f579190e002da89504c77bc149232f91f88ab92a83d42867c36eff72a1fb9b0dbb6b0eae056de654@65.21.112.236:30304,enode://d8c55f09929de245759e41e0b07a6bc5e760b34f79577ba19628eb494fbdff7dd5a2859a251baa02fe1a8904932553ef0166523fd07e494e04c637c7f54c6bf2@65.21.112.236:30303,enode://7f2060647bb6b3598cde7c409fc433a1d5f4051b4887fdbf50cccc0fd66c66b1ed5479d8e74afe81451dfb58a82a47b36b6b144e636b548224d58029417bef21@65.108.14.187:30303,enode://d1438b13c5e2d7299a648cbbc720025376b997a4af277633d96724d4273c54ca739290efc13e2c4454518d5d048839075575e4e49d554984a802acf7c949196e@65.108.0.235:30303,enode://7f2060647bb6b3598cde7c409fc433a1d5f4051b4887fdbf50cccc0fd66c66b1ed5479d8e74afe81451dfb58a82a47b36b6b144e636b548224d58029417bef21@65.108.14.187:30303,enode://d1438b13c5e2d7299a648cbbc720025376b997a4af277633d96724d4273c54ca739290efc13e2c4454518d5d048839075575e4e49d554984a802acf7c949196e@65.108.0.235:30303"
      - "--staticpeers=enode://db210a13910d6344b284c16647231e82173643271618a2c2f579190e002da89504c77bc149232f91f88ab92a83d42867c36eff72a1fb9b0dbb6b0eae056de654@65.21.112.236:30304,enode://d8c55f09929de245759e41e0b07a6bc5e760b34f79577ba19628eb494fbdff7dd5a2859a251baa02fe1a8904932553ef0166523fd07e494e04c637c7f54c6bf2@65.21.112.236:30303,enode://7f2060647bb6b3598cde7c409fc433a1d5f4051b4887fdbf50cccc0fd66c66b1ed5479d8e74afe81451dfb58a82a47b36b6b144e636b548224d58029417bef21@65.108.14.187:30303,enode://d1438b13c5e2d7299a648cbbc720025376b997a4af277633d96724d4273c54ca739290efc13e2c4454518d5d048839075575e4e49d554984a802acf7c949196e@65.108.0.235:30303,enode://f6f21bffa8c89b0ae22bce5c2506719f497552156fc6bfd1305a4412e33d63a476e64dc062dd30ea1a627dbe6ee111a556adaaece97678f0fb35620e3bf87d06@127.0.0.1:30304,enode://7f2060647bb6b3598cde7c409fc433a1d5f4051b4887fdbf50cccc0fd66c66b1ed5479d8e74afe81451dfb58a82a47b36b6b144e636b548224d58029417bef21@65.108.14.187:30303,enode://d1438b13c5e2d7299a648cbbc720025376b997a4af277633d96724d4273c54ca739290efc13e2c4454518d5d048839075575e4e49d554984a802acf7c949196e@65.108.0.235:30303"
      - "--networkid=3501"
      - "--v5disc"
      - "--nodekeyhex=326cf45c720e6822b957dbb861c177d5e9c1ca35e0f056281d4395247f8851bb"
      - "--private.api.addr=0.0.0.0:9090"
      - "--sentry.api.addr=sentry:9091"
      - "--txpool.disable"
    volumes:
      - "./genesis.json:/datadir/genesis.json"
      - "./datadir/erigon:/datadir/erigon"
      - "./init-script.sh:/root/init-script.sh"
    restart: always
    mem_swappiness: 0

  sentry:
    image: jfinchain/erigon:devel
    user: root
    command:
      - "sentry"
      - "--datadir=/datadir/erigon"
      - "--sentry.api.addr=0.0.0.0:9091"
    ports:
      - "30303:30303"
      - "30304:30304"
    volumes:
      - "./datadir/erigon:/datadir/erigon"

  txpool:
    image: jfinchain/erigon:devel
    user: root
    command:
      - "txpool"
      - "--datadir=/datadir/erigon"
      - "--sentry.api.addr=sentry:9091"
      - "--private.api.addr=erigon:9090"
      - "--txpool.api.addr=0.0.0.0:9094"
    volumes:
      - "./datadir/erigon:/datadir/erigon"

  rpcdaemon:
    image: jfinchain/erigon:devel
    user: root
    command:
      - "rpcdaemon"
      - "--datadir=/datadir/erigon"
      - "--private.api.addr=erigon:9090"
      - "--txpool.api.addr=txpool:9094"
      - "--http.addr=0.0.0.0"
      - "--http.api=eth,engine,erigon,web3,net,debug,trace,txpool,ots"
      - "--http.port=8545"
      - "--http.corsdomain=*"
      - "--http.vhosts=*"
      - "--ws"
    ports:
      - "8545:8545"
      - "8546:8546"
    volumes:
      - "./datadir/erigon:/datadir/erigon"
